"use strict";const URL="//api.disneyapi.dev/character?pageSize=50",ulElement=document.querySelector(".js_char_list"),charactersLS=localStorage.getItem("allCharacters"),favSection=document.querySelector(".js_fav_characters"),ulElementFav=document.querySelector(".character_favourite__list");let charactersList=[],favCharacters=[];const searchText=document.querySelector(".js_search_text"),searchBtn=document.querySelector(".js_search_btn");function renderOneCharacter(e){const t=document.createElement("li"),a=document.createElement("img"),r=document.createElement("p"),c=document.createTextNode(e.name);if(t.classList.add("character__item","js_character_item"),t.setAttribute("id",e._id),a.classList.add("character__item-img"),a.src=e.imageUrl,r.classList.add("character__item-name"),r.appendChild(c),t.appendChild(a),t.appendChild(r),!1===e.imageUrl){const e="https://fakeimg.pl/210x295?text=Disney&font=bebas";a.src=e}return t}function renderAllCharacters(e,t){t.innerHTML="";for(const a of e)t.appendChild(renderOneCharacter(a));addEventCharacter()}const handleClickFav=e=>{const t=parseInt(e.currentTarget.id),a=favCharacters.findIndex(e=>e._id===t),r=charactersList.find(e=>e._id===t);-1===a&&favCharacters.push(r),renderFavCharacters(),favCharacters.length>0&&favSection.classList.remove("hidden")};function renderFavCharacters(){renderAllCharacters(favCharacters,ulElementFav),renderDeleteBtn(),deleteFav()}function addEventCharacter(){const e=document.querySelectorAll(".js_character_item"),t=[];for(const a of e)a.addEventListener("click",handleClickFav),a.parentNode.classList.contains("character_favourite__list")&&(t.push(a),a.classList.add("fav__character","js_fav_character"))}function createDeleteBtn(){const e=document.createElement("div"),t=document.createElement("span"),a=document.createTextNode("X");return t.appendChild(a),e.classList.add("delete__fav","js_delete_btn"),t.classList.add("delete__fav-span"),e.appendChild(t),e}function renderDeleteBtn(){const e=document.querySelectorAll(".js_fav_character");for(const t of e)t.appendChild(createDeleteBtn())}function deleteFav(){const e=document.querySelectorAll(".js_fav_character");document.querySelector(".js_delete_btn");for(const t of e)t.addEventListener("click",handleClickDelete)}function handleClickDelete(e){e.preventDefault();const t=parseInt(e.currentTarget.id);if("span"===e.target.nodeName.toLowerCase()){const e=favCharacters.findIndex(e=>e._id===t);favCharacters.splice(e,1),renderFavCharacters()}0===favCharacters.length&&favSection.classList.add("hidden")}function init(){charactersLS?(charactersList=JSON.parse(localStorage.getItem("allCharacters")),renderAllCharacters(charactersList,ulElement)):fetch(URL).then(e=>e.json()).then(e=>{charactersList=e.data,renderAllCharacters(charactersList,ulElement),localStorage.setItem("allCharacters",JSON.stringify(charactersList))}).catch(e=>{console.log(e)})}function handleClickSearch(e){e.preventDefault();const t=searchText.value,a=charactersList.filter(e=>e.name.toLowerCase().includes(t.toLowerCase()));if(renderAllCharacters(a,ulElement),0===a.length){const e=document.createElement("p");e.classList.add("error__msg");const t=document.createTextNode("Lo siento, el personaje que buscas no se encuentra en la base de datos.");e.appendChild(t),ulElement.appendChild(e)}}0===favCharacters.length&&favSection.classList.add("hidden"),init(),searchBtn.addEventListener("click",handleClickSearch);